(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{212:function(s,n,e){"use strict";e.r(n);var a=e(0),t=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("div",{staticClass:"content"},[e("h2",{attrs:{id:"解决跨域问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决跨域问题","aria-hidden":"true"}},[s._v("#")]),s._v(" 解决跨域问题")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("URL")]),s._v(" "),e("th",[s._v("说明")]),s._v(" "),e("th",[s._v("是否允许通信")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("http://www.d.com/d.js"),e("br"),s._v("http://www.d.com/w.js")]),s._v(" "),e("td",[s._v("同一域名下")]),s._v(" "),e("td",[s._v("允许")])]),s._v(" "),e("tr",[e("td",[s._v("http://www.d.com/lab/a.js"),e("br"),s._v("http://www.d.com/src/b.js")]),s._v(" "),e("td",[s._v("同一域名下不同文件夹")]),s._v(" "),e("td",[s._v("允许")])]),s._v(" "),e("tr",[e("td",[s._v("http://www.d.com:3333/a.js"),e("br"),s._v("http://www.d.com:4444/b.js")]),s._v(" "),e("td",[s._v("同一域名不同端口")]),s._v(" "),e("td",[s._v("不允许")])]),s._v(" "),e("tr",[e("td",[s._v("http://www.d.com/a.js"),e("br"),s._v("http://46.33.22.44/b.js")]),s._v(" "),e("td",[s._v("域名和域名对应IP")]),s._v(" "),e("td",[s._v("不允许")])]),s._v(" "),e("tr",[e("td",[s._v("http://www.d.com/a.js"),e("br"),s._v("http://script.d.com/b.js")]),s._v(" "),e("td",[s._v("主域相同，子域不同")]),s._v(" "),e("td",[s._v("不允许")])]),s._v(" "),e("tr",[e("td",[s._v("http://www.d.com/a.js"),e("br"),s._v("http://d.com/b.js")]),s._v(" "),e("td",[s._v("同一域名，不同二级域名（同上）")]),s._v(" "),e("td",[s._v("不允许（cookie这种情况也不允许访问）")])]),s._v(" "),e("tr",[e("td",[s._v("http://www.d.com/a.js"),e("br"),s._v("http://www.v.com/b.js")]),s._v(" "),e("td",[s._v("不同域名")]),s._v(" "),e("td",[s._v("不允许")])])])]),s._v(" "),e("h3",{attrs:{id:"在vue-config-js中处理跨域"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在vue-config-js中处理跨域","aria-hidden":"true"}},[s._v("#")]),s._v(" 在"),e("code",[s._v("vue.config.js")]),s._v("中处理跨域")]),s._v(" "),e("p",[s._v("在本地开发时，通过vueserver起一个本地的开发服务，这个服务的地址一般是localhost，端口一般为8080，如果在本地起一个node服务，端口肯定跟前端服务端口不同，即同域名不同端口，所以存在跨域问题，受同源策略影响，接口将无法调取成功。所以需要设置代理，它将所有接口代理到目标url下。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("devServer: {\n    proxy: 'http://localhost:4000'\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"在后端设置header值解决跨域"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在后端设置header值解决跨域","aria-hidden":"true"}},[s._v("#")]),s._v(" 在后端设置header值解决跨域")]),s._v(" "),e("p",[s._v("node实例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("app.all('*', (req, res, next) => {\n    \x3c!-- 允许访问的域 --\x3e\n    res.header('Access-Control-Allow-Origin','*')\n    \x3c!-- 允许的header --\x3e\n    res.header('Access-Control-Allow-header','X-Requested-With,Content-type')\n    \x3c!-- 允许的方法 --\x3e\n    res.header('Access-Control-Allow-Methods','PUT,POST,GET,DELETE,OPTIONS')\n    next()\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h2",{attrs:{id:"封装axios"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#封装axios","aria-hidden":"true"}},[s._v("#")]),s._v(" 封装axios")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import axios from 'axios'\nimport { baseURL } from '@/config'\nclass HttpRequest {\n  // 当未传入参数，使用baseURL作为默认值\n  // 相当于baseUrl = baseUrl || baseURL\n  constructor (baseUrl = baseURL) {\n    // this相当于要创建的实例\n    this.baseUrl = baseURL\n    // 通过队列把每个请求压入栈中，将每一次请求的url放进去，当队列中没有请求，即所有请求请求完成，将全局loading关闭\n    this.queue = {}\n  }\n  // 返回内部配置\n  getInsideConfig () {\n    const config = {\n      baseUrl: this.baseUrl,\n      header: {\n        //\n      }\n    }\n    return config\n  }\n  // 拦截器，拦截请求和响应\n  interceptors (instance, url) {\n    // 请求拦截器，传入两个回调函数\n    instance.interceptors.request.use(config => {\n      // 添加请求前的控制：全局loading...\n      // iview->Spin.show()\n      // 判断堆栈中有执行的url，打开全局loading Spin.show()\n      if (!Object.keys(this.queue).length) {\n        // Spin.show()\n      }\n      this.queue[url] = true\n      return config\n    }, error => {\n      return Promise.reject(error)\n    })\n    // 响应拦截器\n    instance.interceptors.response.use(res => {\n      // res：服务端返回的数据\n      delete this.queue[url]\n      const { data, status } = res\n      return { data, status }\n    }, error => {\n      delete this.queue[url]\n      return Promise.reject(error)\n    })\n  }\n  // 调用request创建请求\n  request (options) {\n    // axios创建一个实例\n    const instance = axios.create()\n    // options对配置进行合并，将两个对象合并为一个对象，将所有属性合并到一个对象中，如果两个对象中有相同命名的属性值，后面对象的值将覆盖前面相同属性名的值\n    options = Object.assign(this.getInsideConfig(), options)\n    this.interceptors(instance, options.url)\n    return instance(options)\n  }\n}\n\nexport default HttpRequest\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br")])]),e("h3",{attrs:{id:"请求拦截"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#请求拦截","aria-hidden":"true"}},[s._v("#")]),s._v(" 请求拦截")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 请求拦截器，传入两个回调函数\ninstance.interceptors.request.use(config => {\n    // 添加请求前的控制：全局loading...\n    // iview->Spin.show()\n    // 判断堆栈中有执行的url，打开全局loading Spin.show()\n    if (!Object.keys(this.queue).length) {\n    // Spin.show()\n    }\n    this.queue[url] = true\n    return config\n}, error => {\n    return Promise.reject(error)\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h3",{attrs:{id:"响应拦截"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#响应拦截","aria-hidden":"true"}},[s._v("#")]),s._v(" 响应拦截")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 响应拦截器\ninstance.interceptors.response.use(res => {\n    // res：服务端返回的数据\n    delete this.queue[url]\n    const { data, status } = res\n    return { data, status }\n}, error => {\n    delete this.queue[url]\n    return Promise.reject(error)\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h3",{attrs:{id:"队列管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#队列管理","aria-hidden":"true"}},[s._v("#")]),s._v(" 队列管理")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 通过队列把每个请求压入栈中，将每一次请求的url放进去，当队列中没有请求，即所有请求请求完成，将全局loading关闭\nthis.queue = {}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"请求实战"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#请求实战","aria-hidden":"true"}},[s._v("#")]),s._v(" 请求实战")])])}],!1,null,null,null);t.options.__file="Ajax.md";n.default=t.exports}}]);