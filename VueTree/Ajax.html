<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>解决跨域问题 | C.AI 的文档库</title>
    <meta name="description" content="前端工程师 C.AI 的文档库">
    <link rel="icon" href="/cyz.github.io/img/logo.ico">
    
    <link rel="preload" href="/cyz.github.io/assets/css/0.styles.25a0871d.css" as="style"><link rel="preload" href="/cyz.github.io/assets/js/app.fa7d83a1.js" as="script"><link rel="preload" href="/cyz.github.io/assets/js/16.dc2e8114.js" as="script"><link rel="prefetch" href="/cyz.github.io/assets/js/10.6c776c86.js"><link rel="prefetch" href="/cyz.github.io/assets/js/11.c3a345b1.js"><link rel="prefetch" href="/cyz.github.io/assets/js/12.bd0963ae.js"><link rel="prefetch" href="/cyz.github.io/assets/js/13.d25f5ec7.js"><link rel="prefetch" href="/cyz.github.io/assets/js/14.0553bf12.js"><link rel="prefetch" href="/cyz.github.io/assets/js/15.abdbf7d0.js"><link rel="prefetch" href="/cyz.github.io/assets/js/17.350abfb9.js"><link rel="prefetch" href="/cyz.github.io/assets/js/18.854ddd49.js"><link rel="prefetch" href="/cyz.github.io/assets/js/19.4829cccf.js"><link rel="prefetch" href="/cyz.github.io/assets/js/2.e7aea194.js"><link rel="prefetch" href="/cyz.github.io/assets/js/20.c92286a7.js"><link rel="prefetch" href="/cyz.github.io/assets/js/21.1cb5cf30.js"><link rel="prefetch" href="/cyz.github.io/assets/js/22.2a143dfb.js"><link rel="prefetch" href="/cyz.github.io/assets/js/23.496645fb.js"><link rel="prefetch" href="/cyz.github.io/assets/js/24.67ed590b.js"><link rel="prefetch" href="/cyz.github.io/assets/js/25.d262d998.js"><link rel="prefetch" href="/cyz.github.io/assets/js/26.6edfeb65.js"><link rel="prefetch" href="/cyz.github.io/assets/js/27.c18db528.js"><link rel="prefetch" href="/cyz.github.io/assets/js/28.de064934.js"><link rel="prefetch" href="/cyz.github.io/assets/js/29.40cdee03.js"><link rel="prefetch" href="/cyz.github.io/assets/js/3.06243789.js"><link rel="prefetch" href="/cyz.github.io/assets/js/30.5c0d5566.js"><link rel="prefetch" href="/cyz.github.io/assets/js/31.d972648c.js"><link rel="prefetch" href="/cyz.github.io/assets/js/32.300597bd.js"><link rel="prefetch" href="/cyz.github.io/assets/js/33.567d29ad.js"><link rel="prefetch" href="/cyz.github.io/assets/js/4.5efe0cf6.js"><link rel="prefetch" href="/cyz.github.io/assets/js/5.aa5682fb.js"><link rel="prefetch" href="/cyz.github.io/assets/js/6.b4ddb395.js"><link rel="prefetch" href="/cyz.github.io/assets/js/7.b00c76d6.js"><link rel="prefetch" href="/cyz.github.io/assets/js/8.b104f469.js"><link rel="prefetch" href="/cyz.github.io/assets/js/9.2257ccac.js">
    <link rel="stylesheet" href="/cyz.github.io/assets/css/0.styles.25a0871d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cyz.github.io/" class="home-link router-link-active"><!----> <span class="site-name">C.AI 的文档库</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cyz.github.io/" class="nav-link">主页</a></div><div class="nav-item"><a href="/cyz.github.io/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JS相关</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cyz.github.io/canvas/" class="nav-link">Canvas</a></li><li class="dropdown-item"><!----> <a href="/cyz.github.io/JS/" class="nav-link">Javascript语法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">CSS相关</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cyz.github.io/CSS/" class="nav-link">常用布局</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue相关</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cyz.github.io/VUE/" class="nav-link">基础命令</a></li><li class="dropdown-item"><!----> <a href="/cyz.github.io/VueTree/" class="nav-link router-link-active">技术栈</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cyz.github.io/Applet/" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/cyz.github.io/other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Fishcyz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cyz.github.io/" class="nav-link">主页</a></div><div class="nav-item"><a href="/cyz.github.io/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JS相关</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cyz.github.io/canvas/" class="nav-link">Canvas</a></li><li class="dropdown-item"><!----> <a href="/cyz.github.io/JS/" class="nav-link">Javascript语法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">CSS相关</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cyz.github.io/CSS/" class="nav-link">常用布局</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue相关</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cyz.github.io/VUE/" class="nav-link">基础命令</a></li><li class="dropdown-item"><!----> <a href="/cyz.github.io/VueTree/" class="nav-link router-link-active">技术栈</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cyz.github.io/Applet/" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/cyz.github.io/other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Fishcyz" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cyz.github.io/VueTree/" class="sidebar-link">路由</a></li><li><a href="/cyz.github.io/VueTree/Vuex.html" class="sidebar-link">状态管理</a></li><li><a href="/cyz.github.io/VueTree/Ajax.html" class="active sidebar-link">Ajax请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cyz.github.io/VueTree/Ajax.html#解决跨域问题" class="sidebar-link">解决跨域问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cyz.github.io/VueTree/Ajax.html#在vue-config-js中处理跨域" class="sidebar-link">在`vue.config.js`中处理跨域</a></li><li class="sidebar-sub-header"><a href="/cyz.github.io/VueTree/Ajax.html#在后端设置header值解决跨域" class="sidebar-link">在后端设置header值解决跨域</a></li></ul></li><li class="sidebar-sub-header"><a href="/cyz.github.io/VueTree/Ajax.html#封装axios" class="sidebar-link">封装axios</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cyz.github.io/VueTree/Ajax.html#请求拦截" class="sidebar-link">请求拦截</a></li><li class="sidebar-sub-header"><a href="/cyz.github.io/VueTree/Ajax.html#响应拦截" class="sidebar-link">响应拦截</a></li><li class="sidebar-sub-header"><a href="/cyz.github.io/VueTree/Ajax.html#队列管理" class="sidebar-link">队列管理</a></li></ul></li><li class="sidebar-sub-header"><a href="/cyz.github.io/VueTree/Ajax.html#请求实战" class="sidebar-link">请求实战</a></li></ul></li><li><a href="/cyz.github.io/VueTree/Mock.doc.html" class="sidebar-link">Mock文档</a></li><li><a href="/cyz.github.io/VueTree/JS.Library.html" class="sidebar-link">第三方JS库的使用</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="解决跨域问题"><a href="#解决跨域问题" aria-hidden="true" class="header-anchor">#</a> 解决跨域问题</h2> <table><thead><tr><th>URL</th> <th>说明</th> <th>是否允许通信</th></tr></thead> <tbody><tr><td>http://www.d.com/d.js<br>http://www.d.com/w.js</td> <td>同一域名下</td> <td>允许</td></tr> <tr><td>http://www.d.com/lab/a.js<br>http://www.d.com/src/b.js</td> <td>同一域名下不同文件夹</td> <td>允许</td></tr> <tr><td>http://www.d.com:3333/a.js<br>http://www.d.com:4444/b.js</td> <td>同一域名不同端口</td> <td>不允许</td></tr> <tr><td>http://www.d.com/a.js<br>http://46.33.22.44/b.js</td> <td>域名和域名对应IP</td> <td>不允许</td></tr> <tr><td>http://www.d.com/a.js<br>http://script.d.com/b.js</td> <td>主域相同，子域不同</td> <td>不允许</td></tr> <tr><td>http://www.d.com/a.js<br>http://d.com/b.js</td> <td>同一域名，不同二级域名（同上）</td> <td>不允许（cookie这种情况也不允许访问）</td></tr> <tr><td>http://www.d.com/a.js<br>http://www.v.com/b.js</td> <td>不同域名</td> <td>不允许</td></tr></tbody></table> <h3 id="在vue-config-js中处理跨域"><a href="#在vue-config-js中处理跨域" aria-hidden="true" class="header-anchor">#</a> 在<code>vue.config.js</code>中处理跨域</h3> <p>在本地开发时，通过vueserver起一个本地的开发服务，这个服务的地址一般是localhost，端口一般为8080，如果在本地起一个node服务，端口肯定跟前端服务端口不同，即同域名不同端口，所以存在跨域问题，受同源策略影响，接口将无法调取成功。所以需要设置代理，它将所有接口代理到目标url下。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>devServer: {
    proxy: 'http://localhost:4000'
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="在后端设置header值解决跨域"><a href="#在后端设置header值解决跨域" aria-hidden="true" class="header-anchor">#</a> 在后端设置header值解决跨域</h3> <p>node实例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>app.all('*', (req, res, next) =&gt; {
    &lt;!-- 允许访问的域 --&gt;
    res.header('Access-Control-Allow-Origin','*')
    &lt;!-- 允许的header --&gt;
    res.header('Access-Control-Allow-header','X-Requested-With,Content-type')
    &lt;!-- 允许的方法 --&gt;
    res.header('Access-Control-Allow-Methods','PUT,POST,GET,DELETE,OPTIONS')
    next()
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="封装axios"><a href="#封装axios" aria-hidden="true" class="header-anchor">#</a> 封装axios</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>import axios from 'axios'
import { baseURL } from '@/config'
class HttpRequest {
  // 当未传入参数，使用baseURL作为默认值
  // 相当于baseUrl = baseUrl || baseURL
  constructor (baseUrl = baseURL) {
    // this相当于要创建的实例
    this.baseUrl = baseURL
    // 通过队列把每个请求压入栈中，将每一次请求的url放进去，当队列中没有请求，即所有请求请求完成，将全局loading关闭
    this.queue = {}
  }
  // 返回内部配置
  getInsideConfig () {
    const config = {
      baseUrl: this.baseUrl,
      header: {
        //
      }
    }
    return config
  }
  // 拦截器，拦截请求和响应
  interceptors (instance, url) {
    // 请求拦截器，传入两个回调函数
    instance.interceptors.request.use(config =&gt; {
      // 添加请求前的控制：全局loading...
      // iview-&gt;Spin.show()
      // 判断堆栈中有执行的url，打开全局loading Spin.show()
      if (!Object.keys(this.queue).length) {
        // Spin.show()
      }
      this.queue[url] = true
      return config
    }, error =&gt; {
      return Promise.reject(error)
    })
    // 响应拦截器
    instance.interceptors.response.use(res =&gt; {
      // res：服务端返回的数据
      delete this.queue[url]
      const { data, status } = res
      return { data, status }
    }, error =&gt; {
      delete this.queue[url]
      return Promise.reject(error)
    })
  }
  // 调用request创建请求
  request (options) {
    // axios创建一个实例
    const instance = axios.create()
    // options对配置进行合并，将两个对象合并为一个对象，将所有属性合并到一个对象中，如果两个对象中有相同命名的属性值，后面对象的值将覆盖前面相同属性名的值
    options = Object.assign(this.getInsideConfig(), options)
    this.interceptors(instance, options.url)
    return instance(options)
  }
}

export default HttpRequest

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h3 id="请求拦截"><a href="#请求拦截" aria-hidden="true" class="header-anchor">#</a> 请求拦截</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 请求拦截器，传入两个回调函数
instance.interceptors.request.use(config =&gt; {
    // 添加请求前的控制：全局loading...
    // iview-&gt;Spin.show()
    // 判断堆栈中有执行的url，打开全局loading Spin.show()
    if (!Object.keys(this.queue).length) {
    // Spin.show()
    }
    this.queue[url] = true
    return config
}, error =&gt; {
    return Promise.reject(error)
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="响应拦截"><a href="#响应拦截" aria-hidden="true" class="header-anchor">#</a> 响应拦截</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 响应拦截器
instance.interceptors.response.use(res =&gt; {
    // res：服务端返回的数据
    delete this.queue[url]
    const { data, status } = res
    return { data, status }
}, error =&gt; {
    delete this.queue[url]
    return Promise.reject(error)
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="队列管理"><a href="#队列管理" aria-hidden="true" class="header-anchor">#</a> 队列管理</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 通过队列把每个请求压入栈中，将每一次请求的url放进去，当队列中没有请求，即所有请求请求完成，将全局loading关闭
this.queue = {}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="请求实战"><a href="#请求实战" aria-hidden="true" class="header-anchor">#</a> 请求实战</h2></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/15/2019, 5:23:27 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/cyz.github.io/VueTree/Vuex.html" class="prev">
          状态管理
        </a></span> <span class="next"><a href="/cyz.github.io/VueTree/Mock.doc.html">
          Mock文档
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/cyz.github.io/assets/js/app.fa7d83a1.js" defer></script><script src="/cyz.github.io/assets/js/16.dc2e8114.js" defer></script>
  </body>
</html>
